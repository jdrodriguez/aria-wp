!function(){"use strict";class e{constructor(e){this.config=Object.assign({position:"bottom-right",theme:"light",primaryColor:"#2271b1",autoOpenDelay:0,enableSound:!0,enableAnimations:!0,showAvatar:!0,requireEmail:!1,gdprEnabled:!1,apiEndpoint:window.ariaChat?window.ariaChat.ajaxUrl:"/wp-admin/admin-ajax.php",mobileFullscreen:!0,enableAnalytics:!0,detectSystemTheme:!0},e),this.isOpen=!1,this.isMinimized=!1,this.conversationId=null,this.messageQueue=[],this.isTyping=!1,this.sessionData={},this.init()}init(){this.createChatElements(),this.bindEvents(),this.applyStyles(),this.applyTheme(),this.loadSession(),this.config.autoOpenDelay>0&&setTimeout(()=>{this.isOpen||this.hasInteracted()||this.open()},1e3*this.config.autoOpenDelay),this.isReturningVisitor()&&this.showWelcomeBack()}createChatElements(){this.container=document.createElement("div"),this.container.className=`aria-chat-widget aria-position-${this.config.position} aria-theme-${this.config.theme}`,this.container.setAttribute("role","complementary"),this.container.setAttribute("aria-label","Chat with Aria"),this.createChatButton(),this.createChatWindow(),document.body.appendChild(this.container)}createChatButton(){this.button=document.createElement("button"),this.button.className="aria-chat-button",this.button.setAttribute("aria-label","Open chat"),this.button.innerHTML='\n                <span class="aria-button-icon">\n                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">\n                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.2L4 17.2V4h16v12z"/>\n                        <circle cx="8" cy="9.5" r="1.5"/>\n                        <circle cx="12" cy="9.5" r="1.5"/>\n                        <circle cx="16" cy="9.5" r="1.5"/>\n                    </svg>\n                </span>\n            ',this.container.appendChild(this.button)}createChatWindow(){this.window=document.createElement("div"),this.window.className="aria-chat-window",this.window.style.display="none",this.window.setAttribute("role","dialog"),this.window.setAttribute("aria-labelledby","aria-chat-title"),this.window.innerHTML=`\n                <div class="aria-chat-header">\n                    <div class="aria-header-content">\n                        ${this.config.showAvatar?'\n                            <div class="aria-avatar aria-logo-light" aria-label="Aria"></div>\n                        ':""}\n                        <div class="aria-header-info">\n                            <h3 id="aria-chat-title" class="aria-header-title">Aria</h3>\n                            <span class="aria-header-status">\n                                <span class="aria-status-dot"></span>\n                                ${window.ariaChat?window.ariaChat.strings.online:"Online"}\n                            </span>\n                        </div>\n                    </div>\n                    <div class="aria-header-actions">\n                        <button class="aria-close-btn" aria-label="${window.ariaChat?window.ariaChat.strings.close:"Close"}">\n                            <svg viewBox="0 0 24 24" width="20" height="20">\n                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n                            </svg>\n                        </button>\n                    </div>\n                </div>\n                \n                <div class="aria-chat-messages" role="log" aria-live="polite">\n                    <div class="aria-messages-container"></div>\n                    <div class="aria-typing-indicator" style="display: none;">\n                        <span></span>\n                        <span></span>\n                        <span></span>\n                    </div>\n                </div>\n                \n                <div class="aria-chat-input-container">\n                    <form class="aria-chat-form">\n                        <div class="aria-input-group">\n                            <input \n                                type="text" \n                                class="aria-message-input" \n                                placeholder="${window.ariaChat?window.ariaChat.strings.typeMessage:"Type your message..."}"\n                                aria-label="${window.ariaChat?window.ariaChat.strings.typeMessage:"Type your message..."}"\n                                autocomplete="off"\n                            />\n                            <button type="submit" class="aria-send-btn" aria-label="${window.ariaChat?window.ariaChat.strings.send:"Send"}">\n                                <svg viewBox="0 0 24 24" width="20" height="20">\n                                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n                                </svg>\n                            </button>\n                        </div>\n                    </form>\n                </div>\n                \n                <div class="aria-powered-by">\n                    <span>${window.ariaChat?window.ariaChat.strings.poweredBy:"Powered by"} Aria</span>\n                    ${this.config.gdprEnabled?`<span class="aria-privacy-notice">${window.ariaChat?window.ariaChat.gdprMessage:"By using this chat, you agree to our privacy policy."}</span>`:""}\n                </div>\n            `,this.container.appendChild(this.window),this.messagesContainer=this.window.querySelector(".aria-messages-container"),this.messageInput=this.window.querySelector(".aria-message-input"),this.chatForm=this.window.querySelector(".aria-chat-form"),this.typingIndicator=this.window.querySelector(".aria-typing-indicator")}bindEvents(){this.button.addEventListener("click",()=>this.toggle()),this.window.querySelector(".aria-close-btn").addEventListener("click",()=>this.close()),this.chatForm.addEventListener("submit",e=>this.handleSubmit(e)),this.messageInput.addEventListener("keypress",e=>this.handleKeypress(e)),this.messageInput.addEventListener("input",e=>this.handleInput(e)),window.addEventListener("resize",()=>this.handleResize()),document.addEventListener("visibilitychange",()=>this.handleVisibilityChange())}applyStyles(){const e=document.createElement("style"),a=window.ariaChat&&window.ariaChat.pluginUrl?window.ariaChat.pluginUrl:"/wp-content/plugins/aria/";e.textContent=`\n                .aria-chat-widget {\n                    --aria-primary: ${this.config.primaryColor};\n                    --aria-secondary: ${this.config.secondaryColor||"#f0f0f1"};\n                    --aria-text: ${this.config.textColor||"#1e1e1e"};\n                }\n                .aria-logo-light {\n                    background-image: url('${a}public/images/aria.png') !important;\n                }\n                .aria-logo-dark {\n                    background-image: url('${a}public/images/aria-lite.png') !important;\n                }\n            `,document.head.appendChild(e)}loadSession(){const e=this.getSessionId(),a=localStorage.getItem("aria_session_"+e);if(a)try{if(this.sessionData=JSON.parse(a),this.conversationId=this.sessionData.conversationId,this.sessionData.messages&&this.sessionData.timestamp){const e=Date.now()-36e5;this.sessionData.timestamp>e&&this.restoreMessages(this.sessionData.messages)}}catch(e){}}saveSession(){const e=this.getSessionId();this.sessionData.conversationId=this.conversationId,this.sessionData.timestamp=Date.now(),this.sessionData.messages=this.getMessageHistory(),localStorage.setItem("aria_session_"+e,JSON.stringify(this.sessionData))}getSessionId(){let e=sessionStorage.getItem("aria_session_id");return e||(e="aria_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("aria_session_id",e)),e}isReturningVisitor(){return"true"===localStorage.getItem("aria_returning_visitor")}hasInteracted(){return"true"===sessionStorage.getItem("aria_interacted")}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen=!0,this.window.style.display="block",this.button.classList.add("aria-button-hidden"),this.config.enableAnimations?(this.window.classList.add("aria-window-opening"),setTimeout(()=>{this.window.classList.remove("aria-window-opening"),this.window.classList.add("aria-window-open")},10)):this.window.classList.add("aria-window-open"),setTimeout(()=>{this.messageInput.focus()},300),sessionStorage.setItem("aria_interacted","true"),this.conversationId||this.sessionData.name&&this.sessionData.email||this.showUserInfoForm(),this.trackEvent("chat_opened")}close(){this.isOpen=!1,this.config.enableAnimations?(this.window.classList.add("aria-window-closing"),setTimeout(()=>{this.window.style.display="none",this.window.classList.remove("aria-window-open","aria-window-closing"),this.button.classList.remove("aria-button-hidden")},300)):(this.window.style.display="none",this.window.classList.remove("aria-window-open"),this.button.classList.remove("aria-button-hidden")),this.saveSession(),this.trackEvent("chat_closed")}sendInitialGreeting(){this.sessionData.name&&this.sessionData.email?this.sendRequest("aria_start_conversation",{page_url:window.location.href,page_title:document.title,name:this.sessionData.name,email:this.sessionData.email},e=>{e.success&&(this.conversationId=e.data.conversation_id,this.addMessage(e.data.greeting,"aria"),e.data.session_id&&sessionStorage.setItem("aria_session_id",e.data.session_id),localStorage.setItem("aria_returning_visitor","true"))}):this.showUserInfoForm()}showWelcomeBack(){const e=this.button.querySelector(".aria-notification-badge");e&&(e.style.display="block")}showUserInfoForm(){const e=`\n                <div class="aria-user-info-form">\n                    <p>${window.ariaChat&&window.ariaChat.strings.welcomeMessage?window.ariaChat.strings.welcomeMessage:"Welcome! Please introduce yourself so I can assist you better."}</p>\n                    <form class="aria-info-form" id="aria-user-info-form">\n                        <div class="aria-form-group">\n                            <input type="text" \n                                   id="aria-user-name" \n                                   class="aria-form-input" \n                                   placeholder="${window.ariaChat?window.ariaChat.strings.enterName:"Your name"}"\n                                   required />\n                        </div>\n                        <div class="aria-form-group">\n                            <input type="email" \n                                   id="aria-user-email" \n                                   class="aria-form-input" \n                                   placeholder="${window.ariaChat?window.ariaChat.strings.enterEmail:"Your email"}"\n                                   required />\n                        </div>\n                        <div class="aria-form-group">\n                            <textarea id="aria-user-message" \n                                      class="aria-form-textarea" \n                                      placeholder="${window.ariaChat?window.ariaChat.strings.addNote:"How can we help you today?"}"\n                                      rows="3"\n                                      required></textarea>\n                        </div>\n                        <button type="submit" class="aria-form-submit">\n                            ${window.ariaChat?window.ariaChat.strings.startChat:"Start Chat"}\n                        </button>\n                    </form>\n                </div>\n            `,a=document.createElement("div");a.className="aria-message aria-message-system",a.innerHTML=e,this.messagesContainer.appendChild(a);const t=a.querySelector("#aria-user-info-form");t.addEventListener("submit",e=>this.handleUserInfoSubmit(e)),setTimeout(()=>{const e=t.querySelector("#aria-user-name");e&&e.focus()},100),this.chatForm.style.display="none"}handleUserInfoSubmit(e){e.preventDefault();const a=e.target,t=a.querySelector("#aria-user-name").value.trim(),i=a.querySelector("#aria-user-email").value.trim(),s=a.querySelector("#aria-user-message").value.trim();t&&i&&s&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)?(this.sessionData.name=t,this.sessionData.email=i,this.saveSession(),a.closest(".aria-message").remove(),this.chatForm.style.display="",this.addMessage(s,"user"),this.showTyping(),this.sendMessage(s)):this.addMessage(window.ariaChat?window.ariaChat.strings.invalidEmail:"Please enter a valid email address.","aria"))}handleSubmit(e){e.preventDefault();const a=this.messageInput.value.trim();a&&(!this.config.requireEmail||this.sessionData.email?(this.addMessage(a,"user"),this.messageInput.value="",this.showTyping(),this.sendMessage(a)):this.requestEmail(a))}requestEmail(e=null){this.addMessage(window.ariaChat?window.ariaChat.strings.emailRequired:"Please provide your email to continue.","aria"),e&&(this.pendingMessage=e),this.awaitingEmail=!0,this.messageInput.setAttribute("type","email"),this.messageInput.setAttribute("placeholder",window.ariaChat&&window.ariaChat.strings.enterEmail||"Enter your email address...")}handleKeypress(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.chatForm.dispatchEvent(new Event("submit")))}handleInput(e){}addMessage(e,a="user",t={}){const i=document.createElement("div");i.className=`aria-message aria-message-${a}`;let s="";"aria"===a&&this.config.showAvatar&&(s+=`\n                    <div class="aria-message-avatar aria-avatar-aria ${"dark"===this.currentTheme?"aria-logo-dark":"aria-logo-light"}" aria-label="Aria"></div>\n                `),s+=`\n                <div class="aria-message-content">\n                    <div class="aria-message-text">${this.formatMessageText(e)}</div>\n                    <div class="aria-message-time">${this.formatTime()}</div>\n                </div>\n            `,i.innerHTML=s,this.messagesContainer.appendChild(i),this.config.enableAnimations&&(i.classList.add("aria-message-new"),setTimeout(()=>i.classList.remove("aria-message-new"),10)),this.scrollToBottom(),this.config.enableSound&&"aria"===a&&!t.skipSound&&this.playNotificationSound(),this.saveSession()}sendMessage(e){if(this.awaitingEmail)return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(this.sessionData.email=e,this.awaitingEmail=!1,this.addMessage(window.ariaChat?window.ariaChat.strings.thankYouEmail:"Thank you! How can I help you today?","aria"),this.messageInput.setAttribute("type","text"),this.messageInput.setAttribute("placeholder",window.ariaChat?window.ariaChat.strings.typeMessage:"Type your message..."),void(this.pendingMessage&&setTimeout(()=>{this.showTyping(),this.sendMessage(this.pendingMessage),this.pendingMessage=null},1e3))):void this.addMessage(window.ariaChat?window.ariaChat.strings.invalidEmail:"Please enter a valid email address.","aria");this.sendRequest("aria_send_message",{conversation_id:this.conversationId,session_id:this.getSessionId(),message:e,name:this.sessionData.name||null,email:this.sessionData.email||null},e=>{this.hideTyping(),e.success?(this.addMessage(e.data.response,"aria"),e.data.action&&this.handleSpecialAction(e.data.action),e.data.conversation_id&&(this.conversationId=e.data.conversation_id)):this.addMessage(e.data?.message||(window.ariaChat?window.ariaChat.strings.errorMessage:null)||"Something went wrong. Please try again.","aria")})}handleSpecialAction(e){switch(e.type){case"request_human":this.requestHumanHandoff();break;case"show_products":this.showProductSuggestions(e.data);break;case"collect_feedback":this.showFeedbackRequest();break;case"show_articles":this.showArticleSuggestions(e.data);break;case"collect_email":this.requestEmail();break;case"end_conversation":this.endConversation()}}requestHumanHandoff(){this.addMessage(window.ariaChat?window.ariaChat.strings.connectingHuman:"Connecting you with a human...","system")}showProductSuggestions(e){const a=e.map(e=>`\n                <div class="aria-product-suggestion">\n                    <img src="${e.image}" alt="${e.title}">\n                    <h4>${e.title}</h4>\n                    <p>${e.price}</p>\n                    <a href="${e.url}" target="_blank">${window.ariaChat?window.ariaChat.strings.viewProduct:"View Product"}</a>\n                </div>\n            `).join(""),t=document.createElement("div");t.className="aria-message aria-message-products",t.innerHTML=a,this.messagesContainer.appendChild(t),this.scrollToBottom()}showFeedbackRequest(){const e=`\n                <div class="aria-feedback-request">\n                    <p>${window.ariaChat?window.ariaChat.strings.wasHelpful:"Was this conversation helpful?"}</p>\n                    <button class="aria-feedback-btn" data-rating="positive">👍</button>\n                    <button class="aria-feedback-btn" data-rating="negative">👎</button>\n                </div>\n            `,a=document.createElement("div");a.className="aria-message aria-message-feedback",a.innerHTML=e,this.messagesContainer.appendChild(a),a.querySelectorAll(".aria-feedback-btn").forEach(e=>{e.addEventListener("click",e=>this.submitFeedback(e.target.dataset.rating))}),this.scrollToBottom()}submitFeedback(e){this.sendRequest("aria_submit_feedback",{conversation_id:this.conversationId,rating:e},e=>{if(e.success){const e=this.messagesContainer.querySelector(".aria-feedback-request");e&&(e.innerHTML=`<p>${window.ariaChat?window.ariaChat.strings.thanksFeedback:"Thank you for your feedback!"}</p>`)}})}showTyping(){this.isTyping=!0,this.typingIndicator.style.display="flex",this.scrollToBottom()}hideTyping(){this.isTyping=!1,this.typingIndicator.style.display="none"}sendRequest(e,a,t){const i=new XMLHttpRequest;if(i.open("POST",this.config.apiEndpoint,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onload=function(){if(200===i.status)try{const e=JSON.parse(i.responseText);t(e)}catch(e){t({success:!1})}else t({success:!1})},i.onerror=function(){t({success:!1})},!window.ariaChat||!window.ariaChat.nonce)return void t({success:!1,data:{message:"Configuration error: Missing security token. Please refresh the page."}});const s=new URLSearchParams({action:e,nonce:window.ariaChat.nonce,...a});i.send(s.toString())}scrollToBottom(){const e=this.window.querySelector(".aria-chat-messages");e.scrollTop=e.scrollHeight}formatTime(){return(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}applyTheme(){let e=this.config.theme;if(this.config.detectSystemTheme&&window.matchMedia){const a=window.matchMedia("(prefers-color-scheme: dark)");e=a.matches?"dark":"light",a.addEventListener("change",e=>{this.setTheme(e.matches?"dark":"light")})}this.setTheme(e)}setTheme(e){this.currentTheme=e,this.container.classList.remove("aria-theme-light","aria-theme-dark"),this.container.classList.add(`aria-theme-${e}`),this.updateLogos()}updateLogos(){this.container.querySelectorAll(".aria-avatar").forEach(e=>{"dark"===this.currentTheme?(e.classList.remove("aria-logo-light"),e.classList.add("aria-logo-dark")):(e.classList.remove("aria-logo-dark"),e.classList.add("aria-logo-light"))}),this.container.querySelectorAll(".aria-avatar-aria").forEach(e=>{"dark"===this.currentTheme?(e.classList.remove("aria-logo-light"),e.classList.add("aria-logo-dark")):(e.classList.remove("aria-logo-dark"),e.classList.add("aria-logo-light"))})}escapeHtml(e){const a=document.createElement("div");return a.textContent=e,a.innerHTML}getMessageHistory(){const e=[];return this.messagesContainer.querySelectorAll(".aria-message").forEach(a=>{if(a.classList.contains("aria-message-system"))return;const t=a.querySelector(".aria-message-text");if(t){const i=a.classList.contains("aria-message-user")?"user":"aria",s=t.textContent;e.push({sender:i,text:s})}}),e}restoreMessages(e){e.forEach(e=>{this.addMessage(e.text,e.sender,{skipSound:!0})})}playNotificationSound(){try{const e=new(window.AudioContext||window.webkitAudioContext),a=e.createOscillator(),t=e.createGain();a.connect(t),t.connect(e.destination),a.frequency.value=800,a.type="sine",t.gain.setValueAtTime(0,e.currentTime),t.gain.linearRampToValueAtTime(.1,e.currentTime+.01),t.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),a.start(e.currentTime),a.stop(e.currentTime+.1)}catch(e){}}handleResize(){window.innerWidth<768&&this.config.mobileFullscreen?this.window.classList.add("aria-mobile-fullscreen"):this.window.classList.remove("aria-mobile-fullscreen")}handleVisibilityChange(){document.hidden?this.pauseAnimations():this.resumeAnimations()}pauseAnimations(){this.container.classList.add("aria-animations-paused")}resumeAnimations(){this.container.classList.remove("aria-animations-paused")}trackEvent(e,a={}){this.config.enableAnalytics&&this.sendRequest("aria_track_event",{event:e,conversation_id:this.conversationId,...a},()=>{}),"undefined"!=typeof gtag&&gtag("event",e,{event_category:"Aria Chat",...a})}showArticleSuggestions(e){const a=e.map(e=>`\n                <div class="aria-article-suggestion">\n                    <h4><a href="${e.url}" target="_blank">${e.title}</a></h4>\n                    <p>${e.excerpt}</p>\n                </div>\n            `).join(""),t=document.createElement("div");t.className="aria-message aria-message-articles",t.innerHTML=`\n                <div class="aria-articles-container">\n                    <p>${window.ariaChat&&window.ariaChat.strings.helpfulArticles||"Here are some helpful articles:"}:</p>\n                    ${a}\n                </div>\n            `,this.messagesContainer.appendChild(t),this.scrollToBottom()}endConversation(){this.addMessage(window.ariaChat&&window.ariaChat.strings.conversationEnded||"Thank you for chatting with me. Have a great day!","aria"),setTimeout(()=>{this.showFeedbackRequest()},1500),setTimeout(()=>{this.conversationId=null,this.saveSession()},5e3)}formatMessageText(e){let a=this.escapeHtml(e);return a=a.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),a=a.replace(/\*(.*?)\*/g,"<em>$1</em>"),a=a.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),a=a.replace(/(https?:\/\/[^\s<]+|www\.[^\s<]+)/g,function(e){return'<a href="'+(e.startsWith("www.")?"http://"+e:e)+'" target="_blank" rel="noopener">'+e+"</a>"}),a=a.replace(/\n/g,"<br>"),a}destroy(){this.button.removeEventListener("click",this.toggle),window.removeEventListener("resize",this.handleResize),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.saveSession(),this.container.remove(),this.container=null,this.button=null,this.window=null,this.messagesContainer=null,this.messageInput=null,this.chatForm=null,this.typingIndicator=null}}class a{constructor(e,a){this.container=e,this.config=Object.assign({apiEndpoint:window.ariaChat?window.ariaChat.ajaxUrl:"/wp-admin/admin-ajax.php",nonce:window.ariaChat?window.ariaChat.nonce:"",enableSound:!0},a),this.conversationId=null,this.isTyping=!1,this.sessionData={},this.init()}init(){this.cacheElements(),this.bindEvents(),this.loadSession(),this.detectTheme()}cacheElements(){this.formView=this.container.querySelector(".aria-embed-form-view"),this.intakeForm=this.container.querySelector(".aria-embed-intake-form"),this.nameInput=this.container.querySelector("#aria-embed-name"),this.emailInput=this.container.querySelector("#aria-embed-email"),this.messageInput=this.container.querySelector("#aria-embed-message"),this.chatView=this.container.querySelector(".aria-embed-chat-view"),this.messagesContainer=this.container.querySelector(".aria-embed-messages-container"),this.chatForm=this.container.querySelector(".aria-embed-chat-form"),this.chatInput=this.container.querySelector(".aria-embed-message-input"),this.typingIndicator=this.container.querySelector(".aria-typing-indicator"),this.closeButton=this.container.querySelector(".aria-close-btn")}bindEvents(){this.intakeForm.addEventListener("submit",e=>this.handleIntakeSubmit(e)),this.chatForm.addEventListener("submit",e=>this.handleChatSubmit(e)),this.closeButton&&this.closeButton.addEventListener("click",()=>this.switchToForm())}loadSession(){const e=this.getSessionId(),a=sessionStorage.getItem("aria_embed_session_"+e);if(a)try{this.sessionData=JSON.parse(a),this.conversationId=this.sessionData.conversationId}catch(e){}}saveSession(){const e=this.getSessionId();this.sessionData.conversationId=this.conversationId,sessionStorage.setItem("aria_embed_session_"+e,JSON.stringify(this.sessionData))}getSessionId(){let e=sessionStorage.getItem("aria_embed_session_id");return e||(e="aria_embed_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("aria_embed_session_id",e)),e}handleIntakeSubmit(e){e.preventDefault();const a=this.nameInput.value.trim(),t=this.emailInput.value.trim(),i=this.messageInput.value.trim();a&&t&&i&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?(this.sessionData.name=a,this.sessionData.email=t,this.saveSession(),this.switchToChat(),this.startConversation(a,t,i)):this.showError(window.ariaChat?window.ariaChat.strings.invalidEmail:"Please enter a valid email address."))}switchToChat(){this.formView.style.display="none",this.chatView.style.display="flex";const e=this.container.getAttribute("data-aria-height");this.chatView.style.height=e||"600px",this.chatView.offsetHeight}switchToForm(){this.chatView.style.display="none",this.formView.style.display="block",this.intakeForm.reset(),this.messagesContainer.innerHTML="",this.conversationId=null,this.sessionData={},this.saveSession()}startConversation(e,a,t){this.addMessage(t,"user"),this.showTyping(),this.sendRequest("aria_send_message",{message:t,conversation_id:null,session_id:this.getSessionId(),name:e,email:a},e=>{this.hideTyping(),e.success?(this.conversationId=e.data.conversation_id,this.saveSession(),this.addMessage(e.data.response,"aria")):this.addMessage(e.data.message||"An error occurred. Please try again.","aria","error")})}handleChatSubmit(e){e.preventDefault();const a=this.chatInput.value.trim();a&&this.sendMessage(a)}sendMessage(e){this.addMessage(e,"user"),this.chatInput.value="",this.showTyping(),this.sendRequest("aria_send_message",{message:e,conversation_id:this.conversationId,session_id:this.getSessionId(),name:this.sessionData.name||"",email:this.sessionData.email||""},e=>{this.hideTyping(),e.success?(this.conversationId=e.data.conversation_id,this.addMessage(e.data.response,"aria")):this.addMessage(e.data.message||"An error occurred. Please try again.","aria","error")})}addMessage(e,a="aria",t="text"){if(!this.messagesContainer)return;const i=document.createElement("div");if(i.className=`aria-message aria-message-${a} ${"error"===t?"aria-message-error":""}`,"aria"===a){const a="dark"===this.currentTheme?"aria-logo-dark":"aria-logo-light";i.innerHTML=`\n                    <div class="aria-message-avatar aria-avatar-aria ${a}" aria-label="Aria"></div>\n                    <div class="aria-message-content">\n                        ${this.formatMessage(e)}\n                    </div>\n                `}else i.innerHTML=`\n                    <div class="aria-message-content">\n                        ${this.escapeHtml(e)}\n                    </div>\n                `;this.messagesContainer.appendChild(i),i.style.opacity="1",setTimeout(()=>{this.scrollToBottom()},10),"aria"===a&&this.config.enableSound&&this.playNotificationSound()}showTyping(){this.isTyping=!0,this.typingIndicator.style.display="flex",this.scrollToBottom()}hideTyping(){this.isTyping=!1,this.typingIndicator.style.display="none"}scrollToBottom(){const e=this.chatView.querySelector(".aria-embed-chat-messages");e&&(e.scrollTop=e.scrollHeight)}sendRequest(e,a,t){const i=new FormData;i.append("action",e),i.append("nonce",this.config.nonce);for(const e in a)null!==a[e]&&void 0!==a[e]&&i.append(e,a[e]);fetch(this.config.apiEndpoint,{method:"POST",body:i,credentials:"same-origin"}).then(e=>e.json()).then(t).catch(e=>{this.hideTyping(),this.addMessage("Connection error. Please try again.","aria","error")})}showError(e){const a=document.createElement("div");a.className="aria-error-message",a.textContent=e,this.intakeForm.appendChild(a),setTimeout(()=>{a.remove()},3e3)}formatMessage(e){let a=this.escapeHtml(e);return a=a.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),a=a.replace(/\*(.*?)\*/g,"<em>$1</em>"),a=a.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),a=a.replace(/(https?:\/\/[^\s<]+|www\.[^\s<]+)/g,function(e){return'<a href="'+(e.startsWith("www.")?"http://"+e:e)+'" target="_blank" rel="noopener">'+e+"</a>"}),a=a.replace(/\n/g,"<br>"),a}escapeHtml(e){const a=document.createElement("div");return a.textContent=e,a.innerHTML}playNotificationSound(){try{const e=new(window.AudioContext||window.webkitAudioContext),a=e.createOscillator(),t=e.createGain();a.connect(t),t.connect(e.destination),a.frequency.value=800,a.type="sine",t.gain.setValueAtTime(0,e.currentTime),t.gain.linearRampToValueAtTime(.1,e.currentTime+.01),t.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),a.start(e.currentTime),a.stop(e.currentTime+.1)}catch(e){}}detectTheme(){const e=this.container.getAttribute("data-theme");if(e)this.applyTheme(e);else if(window.matchMedia){const e=window.matchMedia("(prefers-color-scheme: dark)"),a=e=>{const a=e?"dark":"light";this.container.setAttribute("data-theme",a),this.applyTheme(a)};a(e.matches),e.addEventListener("change",e=>{a(e.matches)})}}applyTheme(e){this.currentTheme=e,this.container.querySelectorAll(".aria-avatar").forEach(a=>{"dark"===e?(a.classList.remove("aria-logo-light"),a.classList.add("aria-logo-dark")):(a.classList.remove("aria-logo-dark"),a.classList.add("aria-logo-light"))}),this.container.querySelectorAll(".aria-avatar-aria").forEach(a=>{"dark"===e?(a.classList.remove("aria-logo-light"),a.classList.add("aria-logo-dark")):(a.classList.remove("aria-logo-dark"),a.classList.add("aria-logo-light"))})}}function t(){if("undefined"==typeof ariaChat||!ariaChat.enabled)return;window.ariaChatConfig=ariaChat;const t=document.createElement("style"),i=window.ariaChat&&window.ariaChat.pluginUrl?window.ariaChat.pluginUrl:"/wp-content/plugins/aria/";t.textContent=`\n            .aria-logo-light {\n                background-image: url('${i}public/images/aria.png') !important;\n            }\n            .aria-logo-dark {\n                background-image: url('${i}public/images/aria-lite.png') !important;\n            }\n        `,document.head.appendChild(t);const s=document.querySelectorAll('[data-aria-embed="true"]');s.length>0?s.forEach(e=>{new a(e,ariaChat.config)}):window.ariaChatInstance=new e(ariaChat.config)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}();